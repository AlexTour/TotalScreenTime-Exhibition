<!doctype html>
<html lang="en">
  <head>
    <title>&lt;model-viewer&gt; template</title>
    <meta charset="utf-8">
    <meta name="description" content="&lt;model-viewer&gt; template">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" href="./styles.css" rel="stylesheet"/>
  </head>
  <body>
    <script async src="https://ga.jspm.io/npm:es-module-shims@1.7.1/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
        "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@^0.167.1/build/three.module.min.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@^0.167.1/examples/jsm/"
        }
    }
    </script>

    <!-- Import the component -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer/dist/model-viewer-module.min.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer-effects/dist/model-viewer-effects.min.js"></script>
    <!-- <model-viewer> HTML element -->
    <model-viewer src="totalscreentimeAnim-v1.glb" camera-controls poster="poster.webp" shadow-intensity="0.94" exposure="1.5" autoplay>
      <effect-composer id="selectiveComposer" render-mode="quality">
        <selective-bloom-effect strength="5" radius="0.7" threshold="0"></selective-bloom-effect>
        <color-grade-effect></color-grade-effect>
      </effect-composer>
      <div class="progress-bar hide" slot="progress-bar">
          <div class="update-bar"></div>
      </div>
      <button slot="ar-button" id="ar-button">
          View in your space
      </button>
      <div id="ar-prompt">
          <img src="ar_hand_prompt.png">
      </div>
    </model-viewer>  
    <script type="module">
      const selectiveComposer = document.querySelector("effect-composer#selectiveComposer");
      const selectiveBloom = selectiveComposer.querySelector("selective-bloom-effect");

      selectiveComposer.addEventListener('updated-selection', () => {
        const selection = [];
          selectiveComposer.selection.forEach((obj) => 
          (obj.material.emissive.r > 0 
          || obj.material.emissive.g > 0 
          || obj.material.emissive.b > 0) &&
            selection.push(obj)
        );
        selectiveBloom.selection = selection;
      });
    </script>
    <script src="script.js"></script>
  </body>
</html>
